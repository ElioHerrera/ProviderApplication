<app-navhome></app-navhome>

<div class="provider-body">


  <!-- Bloque Relaciones comerciales -->
  <div class="my-providers-container"><br>
    <div class="my-providers-content">
      <h3>Relaciones Comerciales</h3>
      <div class="my-providers">

        <div class="container box-proveedores">
          <div *ngIf="relacionesComerciales.length > 0; else noSolicitudes">
            <div *ngFor="let perfilRelacion of relacionesComerciales" class="proveedor-item"
              (click)="obtenerProductosProveedor(perfilRelacion.id)" (mouseover)="hoverProveedor(perfilRelacion.id)"
              (mouseleave)="leaveProveedor(perfilRelacion.id)"
              [class.hovered]="hoveredProveedorId === perfilRelacion.id"
              [class.clicked]="clickedProveedorId === perfilRelacion.id">
              <div class="proveedor-info">

                <!-- Relaciones Comerciales -->
                <img [lazyLoad]="obtenerImagenPerfil(perfilRelacion.id, perfilRelacion.fotoPerfil)" alt="Profile Image"
                  class="circle-img-lateral" (error)="handleImgError($event)">
                <div class="full-width">
                  <div class="datos-usuarios">
                    <p>
                      <span class="nombre-apellido">{{ perfilRelacion.nombre }} {{ perfilRelacion.apellido}}</span><br>
                      <ng-container *ngIf="perfilRelacion.empresa">
                        <span class="comercio-info">{{ perfilRelacion.empresa.nombre }} - {{
                          perfilRelacion.empresa.domicilio }}</span>
                      </ng-container>
                      <ng-container *ngIf="perfilRelacion.comercio">
                        <span class="comercio-info">{{ perfilRelacion.comercio.nombre }} - {{
                          perfilRelacion.comercio.domicilio }}</span>
                      </ng-container>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <ng-template #noSolicitudes>
            <p>No hay relaciones Comerciales.</p>
          </ng-template>
          <hr>

          <!-- Solicitudes Pendientes-->
          <h3>Solicitudes Pendientes</h3>
          <div *ngIf="solicitudesPendientes">
            <div *ngFor="let perfilRelacion of solicitudesPendientes" class="proveedor-item"
              (click)="obtenerProductosProveedor(perfilRelacion.id)" (mouseover)="hoverProveedor(perfilRelacion.id)"
              (mouseleave)="leaveProveedor(perfilRelacion.id)"
              [class.hovered]="hoveredProveedorId === perfilRelacion.id"
              [class.clicked]="clickedProveedorId === perfilRelacion.id">
              <div class="proveedor-info">
                <img [lazyLoad]="obtenerImagenPerfil(perfilRelacion.id, perfilRelacion.fotoPerfil)" alt="Profile Image"
                  class="circle-img-lateral" (error)="handleImgError($event)">
                <div class="full-width">
                  <div class="datos-usuarios">
                    <p>
                      <span class="nombre-apellido">{{ perfilRelacion.nombre }} {{ perfilRelacion.apellido}}</span><br>
                      <ng-container *ngIf="perfilRelacion.empresa">
                        <span class="comercio-info">{{ perfilRelacion.empresa.nombre }} - {{
                          perfilRelacion.empresa.domicilio }}</span>
                      </ng-container>
                      <ng-container *ngIf="perfilRelacion.comercio">
                        <span class="comercio-info">{{ perfilRelacion.comercio.nombre }} - {{
                          perfilRelacion.comercio.domicilio }}</span>
                      </ng-container>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>



  <div class="toggle-sidebar-container">
    <!-- Botón de menú para pantallas pequeñas -->
    <button class="menu-button" (click)="toggleSidebar()">
      <span class="vertical-line-1"></span>
      <span class="vertical-line-2"></span>
    </button>
    <!-- Sección de datos personales para movil-->
    <div class="sidebar" [class.active]="isSidebarActive">
      <h2>Mis Proveedores</h2>
      <div class="my-providers-content">
        <div class="my-providers-date">
          <div class="container box-proveedores">
            <div *ngIf="relacionesComerciales.length > 0; else noSolicitudes">
              <div *ngFor="let perfilRelacion of relacionesComerciales" class="proveedor-item"
                (click)="obtenerProductosProveedor(perfilRelacion.id)" (mouseover)="hoverProveedor(perfilRelacion.id)"
                (mouseleave)="leaveProveedor(perfilRelacion.id)"
                [class.hovered]="hoveredProveedorId === perfilRelacion.id"
                [class.clicked]="clickedProveedorId === perfilRelacion.id">
                <div class="proveedor-info">

                  <!-- Relaciones Comerciales para movil-->
                  <img [lazyLoad]="obtenerImagenPerfil(perfilRelacion.id, perfilRelacion.fotoPerfil)"
                    alt="Profile Image" class="circle-img-lateral" (error)="handleImgError($event)">
                  <div class="full-width">
                    <div class="datos-usuarios">
                      <p>
                        <span class="nombre-apellido">{{ perfilRelacion.nombre }} {{
                          perfilRelacion.apellido}}</span><br>
                        <ng-container *ngIf="perfilRelacion.empresa">
                          <span class="comercio-info">{{ perfilRelacion.empresa.nombre }} - {{
                            perfilRelacion.empresa.domicilio }}</span>
                        </ng-container>
                        <ng-container *ngIf="perfilRelacion.comercio">
                          <span class="comercio-info">{{ perfilRelacion.comercio.nombre }} - {{
                            perfilRelacion.comercio.domicilio }}</span>
                        </ng-container>
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <ng-template #noSolicitudes>
              <p>No hay relaciones Comerciales.</p>
            </ng-template>
            <hr>
            <!-- Solicitudes Pendientes-->
            <h3>Solicitudes Pendientes</h3>
            <div *ngIf="solicitudesPendientes">
              <div *ngFor="let perfilRelacion of solicitudesPendientes" class="proveedor-item"
                (click)="obtenerProductosProveedor(perfilRelacion.id)" (mouseover)="hoverProveedor(perfilRelacion.id)"
                (mouseleave)="leaveProveedor(perfilRelacion.id)"
                [class.hovered]="hoveredProveedorId === perfilRelacion.id"
                [class.clicked]="clickedProveedorId === perfilRelacion.id">
                <div class="proveedor-info">
                  <img [lazyLoad]="obtenerImagenPerfil(perfilRelacion.id, perfilRelacion.fotoPerfil)"
                    alt="Profile Image" class="circle-img-lateral" (error)="handleImgError($event)">
                  <div class="full-width">
                    <div class="datos-usuarios">
                      <p>
                        <span class="nombre-apellido">{{ perfilRelacion.nombre }} {{
                          perfilRelacion.apellido}}</span><br>
                        <ng-container *ngIf="perfilRelacion.empresa">
                          <span class="comercio-info">{{ perfilRelacion.empresa.nombre }} - {{
                            perfilRelacion.empresa.domicilio }}</span>
                        </ng-container>
                        <ng-container *ngIf="perfilRelacion.comercio">
                          <span class="comercio-info">{{ perfilRelacion.comercio.nombre }} - {{
                            perfilRelacion.comercio.domicilio }}</span>
                        </ng-container>
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bloque Productos -->

  <div class="products-container">


    <!-- Buscar Proveedor -->
    <h2 class="text-center">Buscar Proveedores</h2>
    <input type="text" [(ngModel)]="busquedaProveedor" placeholder="Ingrese el nombre del proveedor...">
    <button mat-flat-button color="primary" (click)="buscarProveedor()">Buscar</button>
    
    
    <div class="container box-proveedores">
      <br>
      <div *ngIf="proveedoresEncontrados.length > 0; else noProveedores">
        <div *ngFor="let proveedor of proveedoresEncontrados">
          <div class="proveedor-info">
            <img [src]="obtenerImagenPerfil(proveedor.id, proveedor.fotoPerfil)" alt="Profile Image"
              class="circle-img-lateral" (error)="handleImgError($event)">
            <div class="full-width">
              <div class="datos-usuarios">
                <p>
                  <span class="nombre-apellido">{{ proveedor.nombre }} {{ proveedor.apellido }}</span><br>
                  <ng-container *ngIf="proveedor.empresa">
                    <span class="comercio-info">{{ proveedor.empresa.nombre }} - {{ proveedor.empresa.domicilio
                      }}</span>
                  </ng-container><br>

                  <!-- Botón para enviar solicitud -->
                  <button mat-flat-button color="primary" (click)="enviarSolicitud(proveedor.id)"
                    [disabled]="solicitudesEnviadas.get(proveedor.id)" style="height: 15px;">
                    {{ solicitudesEnviadas.get(proveedor.id) ? 'Solicitud Enviada' : 'Enviar Solicitud' }}
                  </button>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <ng-template #noProveedores>
        <p>No se encontraron proveedores.</p>
      </ng-template>
    </div>





      <!-- AQUI COLOCAR TARJETA DE PROVEEDOR SELECCIONADO-->





      <div class="gpt-contenedor-tarjetas">
        <h2 class="gpt-texto-centro">Productos</h2><hr>



        <div *ngIf="productosProveedor.length > 0; else noProductos" class="gpt-tarjetas-producto">
          <div *ngFor="let producto of productosProveedor" [class.gpt-fila-desactivada]="!producto.enabled"
            [class.gpt-fila-activada]="producto.enabled" class="gpt-tarjeta-producto-horizontal">

            <!-- Imagen del producto -->
            <div class="gpt-contenedor-imagen-horizontal">
              <img [src]="obtenerImagenProducto(producto.idUsuario, producto.fotoProducto)" alt="Imagen del Producto"
                class="gpt-imagen-producto-horizontal" (error)="handleImgError($event)">
            </div>

            <!-- Detalles del producto -->
            <div class="gpt-detalles-producto-horizontal">
              <h3 class="gpt-nombre-producto-horizontal">{{ producto.nombre }}</h3>
              <p class="gpt-descripcion-producto-horizontal">{{ producto.descripcion }}</p>
              <p class="gpt-precio-producto-horizontal">Precio: <span>{{ producto.precio | currency }}</span></p>
            </div>

            <!-- Controles de cantidad -->
            <div class="gpt-controles-cantidad">
              <button (click)="reducirCantidad(producto)" [disabled]="!producto.enabled"
                class="gpt-boton-cantidad">-</button>
              <input type="number" [(ngModel)]="producto.cantidad" placeholder="0" class="gpt-input-cantidad"
                [disabled]="!producto.enabled" min="0">
              <button (click)="aumentarCantidad(producto)" [disabled]="!producto.enabled"
                class="gpt-boton-cantidad">+</button>
            </div>
          </div>
        </div>

        <ng-template #noProductos>
          <p>No hay productos disponibles para este proveedor.</p>
        </ng-template>

        <button *ngIf="hayProductosSeleccionados" (click)="verPedido()" class="realizar-pedido-btn">

          <span class="pedido-texto">Ver Pedido</span>
          <span class="pedido-total">{{ totalPedido | currency }}</span>

        </button>

      </div>
    </div>
  </div>



    